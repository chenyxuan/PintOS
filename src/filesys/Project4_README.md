# Pintos Project 4 FILESYS 说明文档

------

## 一. 设计概览

* 设计文件索引和可拓展文件，实现文件大小的自动增长，改变文件组织方式，使用inode分散的在硬盘中记录文件。  
* 设计目录组织方式，实现分层目录空间，将目录设计成文件的格式，并使用固定长度的条目进行索引。
* 实现硬盘缓存，使用32KB的空间实现了基本的硬盘缓存，使用时钟算法进行缓存替换。

## 二. 设计细节

### 1.索引与可拓展文件
1) 使用二级inode索引实现文件的索引，文件增长是扩展inode。
2) 文件写入溢出时，申请新的block并修改inode，实现文件增长。


### 2.目录结构

1) 借助文件的结构直接存储每个目录，并设置一个布尔标识符说明其目录属性。
2) 每个目录的条目记录文件的名字和所在位置，以及该条目是否为空条目。
3) 删除条目时直接把该条目置位空条目，增加条目时优先使用空条目。
4) 在文件句柄中使用pos记录被打开的目录当前指向哪一个条目，以实现 `readdir` syscall。

### 3.缓存

1) 在操作系统读写和硬件扇区读写中间添加一层cache作中间层，cache由64个block做成，每个block恰好是一个扇区的大小。每个block记录硬盘的对应位置。
2) 使用`dirty`位和`accessed`位配合时钟算法实现cache的替换。



